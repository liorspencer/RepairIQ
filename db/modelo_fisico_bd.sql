-- Criação do banco de dados
CREATE DATABASE repair_IQ;
USE repair_IQ;
SHOW TABLES;


-- Tabela EQUIPAMENTO
CREATE TABLE EQUIPAMENTO (
    id SMALLINT PRIMARY KEY,
    nome VARCHAR(100),
    tipo VARCHAR(50),
    numero_serie CHAR(30),
    localizacao VARCHAR(100),
    data_aquisicao DATE,
    status BOOLEAN
);
SELECT * FROM EQUIPAMENTO  WHERE status = TRUE;



-- Tabela OCORRENCIA
CREATE TABLE OCORRENCIA (
    id SMALLINT PRIMARY KEY,
    descricao VARCHAR(200),
    status BOOLEAN,
    data_ocorrencia DATE
);
SELECT * FROM    OCORRENCIA;
-- Tabela FUNCIONARIO
CREATE TABLE FUNCIONARIO (
    id SMALLINT PRIMARY KEY,
    nome VARCHAR(40),
    login VARCHAR(20),
    senha CHAR(64)
);
SELECT * FROM FUNCIONARIO;

-- Tabela GRUPO_FUNCIONARIO
CREATE TABLE GRUPO_FUNCIONARIO (
    id SMALLINT PRIMARY KEY,
    nome_grupo VARCHAR(30),
    descricoes VARCHAR(40),
    permicoes VARCHAR(20)
);

-- Tabela NOTIFICACAO
CREATE TABLE NOTIFICACAO (
    id SMALLINT PRIMARY KEY,
    data_envio DATE,
    mensagem VARCHAR(60),
    tipo VARCHAR(20),
    lida VARCHAR(10),
    FK_GRUPO_FUNCIONARIO_id SMALLINT,
    FK_ORDEM_SERVICO_id SMALLINT
);

-- Tabela REGISTRO_AUDITORIA
CREATE TABLE REGISTRO_AUDITORIA (
    id SMALLINT PRIMARY KEY,
    acao VARCHAR(20),
    data_acao DATE,
    detalhes VARCHAR(40),
    FK_FUNCIONARIO_id SMALLINT
);

-- Tabela PREDITIVA_IA
CREATE TABLE PREDITIVA_IA (
    id SMALLINT PRIMARY KEY,
    dados_os_proposta VARCHAR(3000),
    status_aprovacao BOOLEAN,
    FK_EQUIPAMENTO_id SMALLINT
);

-- Tabela ORDEM_SERVICO
CREATE TABLE ORDEM_SERVICO (
    id SMALLINT PRIMARY KEY,
    data_abertura DATE,
    data_fechamento DATE,
    prioridade VARCHAR(20),
    descricao VARCHAR(200),
    FK_EQUIPAMENTO_id SMALLINT,
    FK_OCORRENCIA_id SMALLINT,
    FK_MODELO_ORDEM_SERVICO_id SMALLINT
);

-- Tabela MODELO_ORDEM_SERVICO
CREATE TABLE MODELO_ORDEM_SERVICO (
    id SMALLINT PRIMARY KEY,
    modelo VARCHAR(3000)
);

-- Tabela ORDEM_SERVICO_FUNCIONARIO_trabalha
CREATE TABLE ORDEM_SERVICO_FUNCIONARIO_trabalha (
    fk_ORDEM_SERVICO_id SMALLINT,
    fk_FUNCIONARIO_id SMALLINT
);

-- Tabela pertence
CREATE TABLE pertence (
    fk_FUNCIONARIO_id SMALLINT,
    fk_GRUPO_FUNCIONARIO_id SMALLINT
);

-- Restrições de chave estrangeira
ALTER TABLE NOTIFICACAO ADD CONSTRAINT FK_NOTIFICACAO_2
    FOREIGN KEY (FK_GRUPO_FUNCIONARIO_id)
    REFERENCES GRUPO_FUNCIONARIO (id)
    ON DELETE SET NULL;

ALTER TABLE NOTIFICACAO ADD CONSTRAINT FK_NOTIFICACAO_3
    FOREIGN KEY (FK_ORDEM_SERVICO_id)
    REFERENCES ORDEM_SERVICO (id)
    ON DELETE RESTRICT;

ALTER TABLE REGISTRO_AUDITORIA ADD CONSTRAINT FK_REGISTRO_AUDITORIA_2
    FOREIGN KEY (FK_FUNCIONARIO_id)
    REFERENCES FUNCIONARIO (id)
    ON DELETE CASCADE;

ALTER TABLE PREDITIVA_IA ADD CONSTRAINT FK_PREDITIVA_IA_2
    FOREIGN KEY (FK_EQUIPAMENTO_id)
    REFERENCES EQUIPAMENTO (id)
    ON DELETE SET NULL;

ALTER TABLE ORDEM_SERVICO ADD CONSTRAINT FK_ORDEM_SERVICO_2
    FOREIGN KEY (FK_EQUIPAMENTO_id)
    REFERENCES EQUIPAMENTO (id)
    ON DELETE RESTRICT;

ALTER TABLE ORDEM_SERVICO ADD CONSTRAINT FK_ORDEM_SERVICO_3
    FOREIGN KEY (FK_OCORRENCIA_id)
    REFERENCES OCORRENCIA (id)
    ON DELETE CASCADE;

ALTER TABLE ORDEM_SERVICO ADD CONSTRAINT FK_ORDEM_SERVICO_4
    FOREIGN KEY (FK_MODELO_ORDEM_SERVICO_id)
    REFERENCES MODELO_ORDEM_SERVICO (id)
    ON DELETE CASCADE;

ALTER TABLE ORDEM_SERVICO_FUNCIONARIO_trabalha ADD CONSTRAINT FK_ORDEM_SERVICO_FUNCIONARIO_trabalha_1
    FOREIGN KEY (fk_ORDEM_SERVICO_id)
    REFERENCES ORDEM_SERVICO (id);

ALTER TABLE ORDEM_SERVICO_FUNCIONARIO_trabalha ADD CONSTRAINT FK_ORDEM_SERVICO_FUNCIONARIO_trabalha_2
    FOREIGN KEY (fk_FUNCIONARIO_id)
    REFERENCES FUNCIONARIO (id);

ALTER TABLE pertence ADD CONSTRAINT FK_pertence_1
    FOREIGN KEY (fk_FUNCIONARIO_id)
    REFERENCES FUNCIONARIO (id)
    ON DELETE SET NULL;

ALTER TABLE pertence ADD CONSTRAINT FK_pertence_2
    FOREIGN KEY (fk_GRUPO_FUNCIONARIO_id)
    REFERENCES GRUPO_FUNCIONARIO (id)
    ON DELETE SET NULL;
